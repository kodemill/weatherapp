{"version":3,"sources":["../../src/middleware/is-authenticated.js"],"names":[],"mappings":";;;;;;AAAA;;AACA;;;;;;;;kBAEgB,KAAD,IAAW;AACxB,QAAM,WAAW,QAAQ,WAAR,GAAsB,KAAvC;AACA;AAAA,iCAAO,WAAO,GAAP,EAAY,IAAZ,EAAqB;AAC1B,YAAM,mBAAS,YAAT,CAAsB,QAAtB,EAAgC,gBAAQ;AAC5C,YAAI,IAAJ,EAAU;AACR,cAAI,IAAJ,GAAW,IAAX;AACA,cAAI,KAAJ,EAAW;AACT,gBAAI,KAAJ,GAAY,KAAK,KAAjB;AACD;AACF;AACF,OAPK,EAOH,GAPG,EAOE,IAPF,CAAN;AAQA,UAAI,IAAI,IAAR,EAAc;AACZ,eAAO,MAAP;AACD;AACD,UAAI,KAAJ,0BAAwB,GAAxB;AACD,KAbD;;AAAA;AAAA;AAAA;AAAA;AAcD,C","file":"is-authenticated.js","sourcesContent":["import { unauthorized } from '../constants';\nimport passport from '../lib/passport';\n\nexport default (email) => {\n  const strategy = email ? 'email-jwt' : 'jwt';\n  return async (ctx, next) => {\n    await passport.authenticate(strategy, user => {\n      if (user) {\n        ctx.user = user;\n        if (email) {\n          ctx.email = user.email;\n        }\n      }\n    })(ctx, next);\n    if (ctx.user) {\n      return next();\n    }\n    ctx.throw(unauthorized, 401);\n  };\n};\n"]}