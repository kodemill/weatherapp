{"version":3,"sources":["../../src/middleware/is-authenticated.js"],"names":[],"mappings":";;;;;;AAAA;;AACA;;;;;;;;kBAEgB,KAAD,IAAW;AACxB,QAAM,WAAW,QAAQ,WAAR,GAAsB,KAAvC;AACA;AAAA,iCAAO,WAAO,GAAP,EAAY,IAAZ,EAAqB;AAC1B,YAAM,mBAAS,YAAT,CAAsB,QAAtB,EAAgC,gBAAQ;AAC5C,YAAI,IAAJ,EAAU;AACR,cAAI,IAAJ,GAAW,IAAX;AACA,cAAI,KAAJ,EAAW;AACT,gBAAI,KAAJ,GAAY,KAAK,KAAjB;AACD;AACF;AACF,OAPK,EAOH,GAPG,EAOE,IAPF,CAAN;AAQA,UAAI,IAAI,IAAR,EAAc;AACZ,eAAO,MAAP;AACD;AACD,UAAI,KAAJ,0BAAwB,GAAxB;AACD,KAbD;;AAAA;AAAA;AAAA;AAAA;AAcD,C","file":"is-authenticated.js","sourcesContent":["import { unauthorized } from '../constants';\r\nimport passport from '../lib/passport';\r\n\r\nexport default (email) => {\r\n  const strategy = email ? 'email-jwt' : 'jwt';\r\n  return async (ctx, next) => {\r\n    await passport.authenticate(strategy, user => {\r\n      if (user) {\r\n        ctx.user = user;\r\n        if (email) {\r\n          ctx.email = user.email;\r\n        }\r\n      }\r\n    })(ctx, next);\r\n    if (ctx.user) {\r\n      return next();\r\n    }\r\n    ctx.throw(unauthorized, 401);\r\n  };\r\n};\r\n"]}