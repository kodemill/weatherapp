{"version":3,"sources":["../../src/middleware/serve-index.js"],"names":[],"mappings":";;;;;;AAAA;;;;;;AAEA,MAAM,oBAAoB,SAAU,8BAA4B,KAAM,cAAtE;AACA,MAAM,gBAAgB,SAAtB;AACA,MAAM,oBAAoB,CAAC,EAAE,GAAF,EAAO,MAAP,EAAD,KACxB,OAAO,KAAP,CAAa,MAAb,MAAyB,QAAQ,GAAR,IAAe,QAAQ,aAAhD,CADF;;kBAGe,gBAAgB;AAC7B,QAAM,iBAAiB,aAAG,YAAH,CAAiB,IAAE,YAAa,cAAhC,EAA8C,MAA9C,EAAsD,KAAtD,CAA4D,aAA5D,CAAvB;AACA,QAAM,oBAAoB,SAAU,IAAE,eAAe,CAAf,CAAkB,KAAE,kBAAkB,KAAlB,CAAyB;MAAA,CAC/E,aAAc,KAAE,eAAe,CAAf,CAAkB,GADtC,CAF6B,CAGY;;AAEzC,SAAO,CAAC,GAAD,EAAM,IAAN,KAAe;AACpB,QAAI,kBAAkB,GAAlB,CAAJ,EAA4B;AAC1B,YAAM,mBAAmB,IAAI,WAAJ,CAAgB,KAAhB,CAAsB,GAAtB,CAAzB;AACA,UAAI,iBAAiB,MAAjB,KAA4B,CAA5B,IAAiC,iBAAiB,CAAjB,MAAwB,MAA7D,EAAqE;AACnE,gBAAQ,GAAR,CAAY,yCAAZ;AACA,YAAI,IAAJ,GAAW,kBAAkB,iBAAiB,CAAjB,CAAlB,CAAX;AACD,OAHD,MAGO;AACL,eAAO,MAAP;AACD;AACF,KARD,MAQO;AACL,aAAO,MAAP;AACD;AACF,GAZD;AAaD,C","file":"serve-index.js","sourcesContent":["import fs from 'fs';\n\nconst getInjectedScript = token => `<script>window.__token__='${token}';</script>`;\nconst endingBodyTag = '</body>';\nconst checkUrlAndMethod = ({ url, method }) =>\n  method.match(/GET/i) && (url === '/' || url === '/index.html');\n\nexport default publicFolder => {\n  const splitIndexHtml = fs.readFileSync(`${publicFolder}/index.html`, 'utf8').split(endingBodyTag);\n  const indexHtmlTemplate = token => `${splitIndexHtml[0]}${getInjectedScript(token)}\n    ${endingBodyTag}${splitIndexHtml[1]}`; // newline between tags is ok\n\n  return (ctx, next) => {\n    if (checkUrlAndMethod(ctx)) {\n      const splitOriginalUrl = ctx.originalUrl.split('/');\n      if (splitOriginalUrl.length === 3 && splitOriginalUrl[1] === 'user') {\n        console.log('serveIndex - authenticated index served');\n        ctx.body = indexHtmlTemplate(splitOriginalUrl[2]);\n      } else {\n        return next();\n      }\n    } else {\n      return next();\n    }\n  };\n};\n"]}