{"version":3,"sources":["../../src/middleware/serve-index.js"],"names":[],"mappings":";;;;;;AAAA;;;;;;AAEA,MAAM,oBAAoB,SAAU,8BAA4B,KAAM,cAAtE;AACA,MAAM,gBAAgB,SAAtB;AACA,MAAM,oBAAoB,CAAC,EAAE,GAAF,EAAO,MAAP,EAAD,KACxB,OAAO,KAAP,CAAa,MAAb,MAAyB,QAAQ,GAAR,IAAe,QAAQ,aAAhD,CADF;;kBAGe,gBAAgB;AAC7B,QAAM,iBAAiB,aAAG,YAAH,CAAiB,IAAE,YAAa,cAAhC,EAA8C,MAA9C,EAAsD,KAAtD,CAA4D,aAA5D,CAAvB;AACA,QAAM,oBAAoB,SAAU,IAAE,eAAe,CAAf,CAAkB,KAAE,kBAAkB,KAAlB,CAAyB;MAAA,CAC/E,aAAc,KAAE,eAAe,CAAf,CAAkB,GADtC,CAF6B,CAGY;;AAEzC,SAAO,CAAC,GAAD,EAAM,IAAN,KAAe;AACpB,QAAI,kBAAkB,GAAlB,CAAJ,EAA4B;AAC1B,YAAM,mBAAmB,IAAI,WAAJ,CAAgB,KAAhB,CAAsB,GAAtB,CAAzB;AACA,UAAI,iBAAiB,MAAjB,KAA4B,CAA5B,IAAiC,iBAAiB,CAAjB,MAAwB,MAA7D,EAAqE;AACnE,gBAAQ,GAAR,CAAY,yCAAZ;AACA,YAAI,IAAJ,GAAW,kBAAkB,iBAAiB,CAAjB,CAAlB,CAAX;AACD,OAHD,MAGO;AACL,eAAO,MAAP;AACD;AACF,KARD,MAQO;AACL,aAAO,MAAP;AACD;AACF,GAZD;AAaD,C","file":"serve-index.js","sourcesContent":["import fs from 'fs';\r\n\r\nconst getInjectedScript = token => `<script>window.__token__='${token}';</script>`;\r\nconst endingBodyTag = '</body>';\r\nconst checkUrlAndMethod = ({ url, method }) =>\r\n  method.match(/GET/i) && (url === '/' || url === '/index.html');\r\n\r\nexport default publicFolder => {\r\n  const splitIndexHtml = fs.readFileSync(`${publicFolder}/index.html`, 'utf8').split(endingBodyTag);\r\n  const indexHtmlTemplate = token => `${splitIndexHtml[0]}${getInjectedScript(token)}\r\n    ${endingBodyTag}${splitIndexHtml[1]}`; // newline between tags is ok\r\n\r\n  return (ctx, next) => {\r\n    if (checkUrlAndMethod(ctx)) {\r\n      const splitOriginalUrl = ctx.originalUrl.split('/');\r\n      if (splitOriginalUrl.length === 3 && splitOriginalUrl[1] === 'user') {\r\n        console.log('serveIndex - authenticated index served');\r\n        ctx.body = indexHtmlTemplate(splitOriginalUrl[2]);\r\n      } else {\r\n        return next();\r\n      }\r\n    } else {\r\n      return next();\r\n    }\r\n  };\r\n};\r\n"]}