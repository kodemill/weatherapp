{"version":3,"sources":["../../src/controller/notification.js"],"names":[],"mappings":";;;;;;AAAA;;AACA;;;;AAGA,MAAM;AAAA,+BAAkB,WAAO,iBAAP,EAA0B,OAA1B,EAAsC;AAC5D,QAAI,CAAC,iBAAD,IAAsB,kBAAkB,MAAlB,KAA6B,CAAvD,EAA0D;AACxD;AACD;AACD,UAAM,WAAW,MAAM,uBAAgB,QAAhB,CAAyB,iBAAzB,EAA4C,WAA5C,CAAvB;AACA,UAAM,sBAAsB,SAAS,MAAT,CAAgB;AAAA,aAAa,UAAU,IAAV,CAAe,qBAAf,EAAb;AAAA,KAAhB,EACzB,GADyB,CACrB;AAAA,aACH,CAAC,SAAD,EAAY,QAAQ,IAAR,CAAa;AAAA,eAAU,UAAU,IAAV,CAAe,EAAf,KAAsB,OAAO,IAAP,CAAY,QAAZ,EAAhC;AAAA,OAAb,CAAZ,CADG;AAAA,KADqB,CAA5B;AAGA;AACA,UAAM,gBAAgB,MAAM,QAAQ,GAAR,CAAY,oBACrC,GADqC,CACjC;AAAA,aAAQ,sCAAsB,KAAK,CAAL,CAAtB,EAA+B,KAAK,CAAL,CAA/B,CAAR;AAAA,KADiC,CAAZ,CAA5B;;AAGA,YAAQ,GAAR,CAAY,aAAZ;AACD,GAbK;;AAAA;AAAA;AAAA;AAAA,IAAN;;kBAgBe,EAAE,eAAF,E","file":"notification.js","sourcesContent":["import { WeatherCriteria } from '../model';\nimport { sendNotificationEmail } from '../lib/send-email';\n\n\nconst notificateUsers = async (fulfilledCriteria, reports) => {\n  if (!fulfilledCriteria || fulfilledCriteria.length === 0) {\n    return;\n  }\n  const criteria = await WeatherCriteria.populate(fulfilledCriteria, 'city user');\n  const criteriaReportPairs = criteria.filter(criterion => criterion.user.getNotificationEmails())\n    .map(criterion =>\n      [criterion, reports.find(report => criterion.city.id === report.city.toString())]);\n  // console.log(criteriaReportPairs);\n  const sentMailInfos = await Promise.all(criteriaReportPairs\n    .map(pair => sendNotificationEmail(pair[0], pair[1])));\n\n  console.log(sentMailInfos);\n};\n\n\nexport default { notificateUsers };\n"]}