{"version":3,"sources":["../../src/controller/weather-report.js"],"names":[],"mappings":";;;;;;AAAA;;;;AACA;;;;;;;;AAEA,MAAM;AAAA,+BAA2B,WAAM,MAAN;AAAA,WAC/B,MAAM,8BAAoB,OAApB,CAA4B,EAAE,MAAM,MAAR,EAA5B,CADyB;AAAA,GAA3B;;AAAA;AAAA;AAAA;AAAA,IAAN;;AAGA,MAAM;AAAA,gCAAoB,WAAM,SAAN,EAAmB;AAC3C,UAAM,SAAS,UAAU,EAAzB;AACA,UAAM,YAAY,MAAM,wBAAc,MAAd,CAAqB;AAC3C,YAAM,MADqC;AAE3C,mBAAa,UAAU,IAAV,CAAe,IAFe;AAG3C;AAH2C,KAArB,CAAxB;AAKA,QAAI,sBAAsB,MAAM,yBAAyB,MAAzB,CAAhC;AACA,QAAI,mBAAJ,EAAyB;AACvB,0BAAoB,aAApB,GAAoC,SAApC;AACD,KAFD,MAEO;AACL,4BAAsB,kCAAwB;AAC5C,cAAM,MADsC;AAE5C,uBAAe;AAF6B,OAAxB,CAAtB;AAID;AACD,UAAM,oBAAoB,IAApB,EAAN;AACA,WAAO,SAAP;AACD,GAlBK;;AAAA;AAAA;AAAA;AAAA,IAAN;;AAoBA,MAAM,sBAAsB,mBAC1B,QAAQ,GAAR,CAAY,gBAAgB,IAAhB,CAAqB,GAArB,CAAyB,iBAAzB,CAAZ,CADF;;kBAGe;AACb,mBADa;AAEb,qBAFa;AAGb;AAHa,C","file":"weather-report.js","sourcesContent":["import WeatherReport from '../model/weather-report';\r\nimport LatestWeatherReport from '../model/latest-weather-report';\r\n\r\nconst getLatestReportForCityId = async cityId =>\r\n  await LatestWeatherReport.findOne({ city: cityId });\r\n\r\nconst saveWeatherReport = async rawReport => {\r\n  const cityId = rawReport.id;\r\n  const newReport = await WeatherReport.create({\r\n    city: cityId,\r\n    temperature: rawReport.main.temp,\r\n    rawReport,\r\n  });\r\n  let latestReportForCity = await getLatestReportForCityId(cityId);\r\n  if (latestReportForCity) {\r\n    latestReportForCity.weatherReport = newReport;\r\n  } else {\r\n    latestReportForCity = new LatestWeatherReport({\r\n      city: cityId,\r\n      weatherReport: newReport,\r\n    });\r\n  }\r\n  await latestReportForCity.save();\r\n  return newReport;\r\n};\r\n\r\nconst saveAllFromResponse = weatherResponse =>\r\n  Promise.all(weatherResponse.list.map(saveWeatherReport));\r\n\r\nexport default {\r\n  saveWeatherReport,\r\n  saveAllFromResponse,\r\n  getLatestReportForCityId,\r\n};\r\n"]}