{"version":3,"sources":["../../src/controller/weather-report.js"],"names":[],"mappings":";;;;;;AAAA;;;;AACA;;;;;;;;AAEA,MAAM;AAAA,+BAA2B,WAAM,MAAN;AAAA,WAC/B,MAAM,8BAAoB,OAApB,CAA4B,EAAE,MAAM,MAAR,EAA5B,CADyB;AAAA,GAA3B;;AAAA;AAAA;AAAA;AAAA,IAAN;;AAGA,MAAM;AAAA,gCAAoB,WAAM,SAAN,EAAmB;AAC3C,UAAM,SAAS,UAAU,EAAzB;AACA,UAAM,YAAY,MAAM,wBAAc,MAAd,CAAqB;AAC3C,YAAM,MADqC;AAE3C,mBAAa,UAAU,IAAV,CAAe,IAFe;AAG3C;AAH2C,KAArB,CAAxB;AAKA,QAAI,sBAAsB,MAAM,yBAAyB,MAAzB,CAAhC;AACA,QAAI,mBAAJ,EAAyB;AACvB,0BAAoB,aAApB,GAAoC,SAApC;AACD,KAFD,MAEO;AACL,4BAAsB,kCAAwB;AAC5C,cAAM,MADsC;AAE5C,uBAAe;AAF6B,OAAxB,CAAtB;AAID;AACD,UAAM,oBAAoB,IAApB,EAAN;AACA,WAAO,SAAP;AACD,GAlBK;;AAAA;AAAA;AAAA;AAAA,IAAN;;AAoBA,MAAM,sBAAsB,mBAC1B,QAAQ,GAAR,CAAY,gBAAgB,IAAhB,CAAqB,GAArB,CAAyB,iBAAzB,CAAZ,CADF;;kBAGe;AACb,mBADa;AAEb,qBAFa;AAGb;AAHa,C","file":"weather-report.js","sourcesContent":["import WeatherReport from '../model/weather-report';\nimport LatestWeatherReport from '../model/latest-weather-report';\n\nconst getLatestReportForCityId = async cityId =>\n  await LatestWeatherReport.findOne({ city: cityId });\n\nconst saveWeatherReport = async rawReport => {\n  const cityId = rawReport.id;\n  const newReport = await WeatherReport.create({\n    city: cityId,\n    temperature: rawReport.main.temp,\n    rawReport,\n  });\n  let latestReportForCity = await getLatestReportForCityId(cityId);\n  if (latestReportForCity) {\n    latestReportForCity.weatherReport = newReport;\n  } else {\n    latestReportForCity = new LatestWeatherReport({\n      city: cityId,\n      weatherReport: newReport,\n    });\n  }\n  await latestReportForCity.save();\n  return newReport;\n};\n\nconst saveAllFromResponse = weatherResponse =>\n  Promise.all(weatherResponse.list.map(saveWeatherReport));\n\nexport default {\n  saveWeatherReport,\n  saveAllFromResponse,\n  getLatestReportForCityId,\n};\n"]}